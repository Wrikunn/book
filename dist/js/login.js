"use strict";function exit(){var e=document.createElement("b"),n=document.createElement("img");n.src="img/touxiang.gif",e.appendChild(n);n=document.createElement("i");n.innerText="账号管理",e.appendChild(n);n=document.createElement("strong");n.innerText="|",e.appendChild(n);n=document.createElement("i");n.innerText="退出",e.appendChild(n),n.onclick=function(){quit(),setCookie("username","",-1),location.reload()},logzhu.appendChild(e)}function quit(){for(var e=document.cookie.split(";"),n=void 0,t={},o=0;o<e.length;o++)for(var l=0;l<e[o].split("=").length;l++)"username"==e[o].split("=")[0]&&(n=e[o].split("=")[1]);var s,i=[];for(s in $.ajax({url:"./php/buy.php",dataType:"json",async:!1,success:function(e){console.log(e),e.forEach(function(e){t[e.id]=e.num,i[e.id]=0})}}),t=JSON.stringify(t),localStorage.setItem(n,t),i)$.ajax({url:"./php/car.php",data:{id:s,num:0}});console.log(location.href)}function enter(){for(var e=document.cookie.split(";"),n=void 0,t=0;t<e.length;t++)for(var o=0;o<e[t].split("=").length;o++)"username"==e[t].split("=")[0]&&(n=e[t].split("=")[1]);var l,s=localStorage.getItem(n);for(l in s=JSON.parse(s))$.ajax({url:"./php/car.php",dataType:"json",async:!1,data:{id:l,num:s[l]}});$.ajax({url:"./php/buy.php",async:!1,dataType:"json",success:function(e){0<e.length?$("#car").children().html("您的购物车内有<br>"+e.length+"件商品"):$("#car").children().html("<img src='img/car.png'><br>您的购物车是空的，快去挑些好书放进来吧。")}})}window.onload=function(){for(var e=document.cookie.split(";"),n=0;n<e.length;n++)for(var t=0;t<e[n].split("=").length;t++)"username"==e[n].split("=")[0]&&(logzhu.innerHTML=e[n].split("=")[1],exit(),$.ajax({url:"./php/buy.php",async:!1,dataType:"json",success:function(e){0<e.length?$("#car").children().html("您的购物车内有<br>"+e.length+"件商品"):$("#car").children().html("<img src='img/car.png'><br>您的购物车是空的，快去挑些好书放进来吧。")}}))};var loginbtn=document.querySelectorAll(".loginbtn"),loginbox=document.getElementById("loginbox"),login=document.querySelector(".login"),enroll=document.querySelector(".enroll"),yanzheng=document.querySelector(".yanzheng"),ma=document.querySelector(".ma"),enrollbtn=document.querySelectorAll(".enrollbtn"),yanzhengbtn=document.querySelectorAll(".yanzhengbtn"),mabtn=document.querySelectorAll(".mabtn"),zhuce=document.querySelector("#zhuce");function visib(e){loginbox.style.display="block",enroll.style.display="none",login.style.display="none",yanzheng.style.display="none",ma.style.display="none",e.style.display="block"}for(var i=0;i<enrollbtn.length;i++)enrollbtn[i].onclick=function(){visib(enroll)};for(var j=0;j<loginbtn.length;j++)loginbtn[j].onclick=function(e){e.preventDefault(),visib(login)};for(var k=0;k<yanzhengbtn.length;k++)yanzhengbtn[k].onclick=function(){visib(yanzheng)};for(var m=0;m<mabtn.length;m++)mabtn[m].onclick=function(){visib(ma)};function setCookie(e,n,t){var o=new Date,o=new Date(o.getTime()+60*(24*t-8)*60*1e3);document.cookie=e+"="+n+";expires="+o}var close=document.getElementById("close"),inptxt=document.querySelectorAll(".inputtxt"),inptext=document.querySelectorAll("#loginbox input[type='text']"),inppsw=document.querySelectorAll("#loginbox input[type='password']"),checkbox=document.querySelector(".enroll input[type=checkbox]"),sevenday=document.querySelector(".login input[type=checkbox]");function closefn(){loginbox.style.display="none",zhuce.disabled=!0,checkbox.checked=!1,sevenday.checked=!1;for(var e=0;e<inptxt.length;e++)inptxt[e].style.display="none";for(var n=0;n<inptext.length;n++)inptext[n].value="";for(var t=0;t<inppsw.length;t++)inppsw[t].value=""}close.onclick=closefn,user.onblur=function(){""==user.value&&(document.querySelector("#user+span").innerHTML="请输入用户名",document.querySelector("#user+span").style.display="block")},user.onkeyup=function(){document.querySelector("#user+span").style.display="none"},pass.onblur=function(){""==pass.value&&(document.querySelector("#pass+span").innerHTML="请输入密码",document.querySelector("#pass+span").style.display="block")},pass.onkeyup=function(){document.querySelector("#pass+span").style.display="none"};var loginphp=document.querySelector("#login"),logzhu=document.querySelector("#logzhu");loginphp.onclick=function(){var n;""!=user.value&&""!=pass.value?((n=new XMLHttpRequest).open("get","./php/login.php?username="+user.value+"&password="+pass.value),n.send(),n.onload=function(){var e=JSON.parse(n.responseText);2==e.state?(document.querySelector("#pass+span").innerHTML=e.msg,document.querySelector("#pass+span").style.display="block"):0==e.state?(document.querySelector("#user+span").innerHTML=e.msg,document.querySelector("#user+span").style.display="block"):(logzhu.innerHTML=e.user,sevenday.checked?setCookie("username",e.user,7):setCookie("username",e.user),location.reload(!0),exit(),closefn(),enter())}):(""==user.value&&(document.querySelector("#user+span").innerHTML="请输入用户名",document.querySelector("#user+span").style.display="block"),""==pass.value&&(document.querySelector("#pass+span").innerHTML="请输入密码",document.querySelector("#pass+span").style.display="block"))},checkbox.onchange=function(){this.checked?zhuce.disabled=!1:zhuce.disabled=!0};var phone=document.querySelector("#phone"),niname=document.querySelector("#niname"),newpsw=document.querySelector("#newpsw");zhuce.onclick=function(){var n;""!=phone.value&&""!=niname.value&&""!=newpsw.value?((n=new XMLHttpRequest).open("get","./php/zhuce.php?username="+niname.value+"&password="+newpsw.value+"&phone="+phone.value),n.send(),n.onload=function(){var e=JSON.parse(n.responseText);2==e.state?(document.querySelector("#phone+span").innerHTML=e.msg,document.querySelector("#phone+span").style.display="block"):0==e.state?(document.querySelector("#niname+span").innerHTML=e.msg,document.querySelector("#niname+span").style.display="block"):(logzhu.innerHTML=niname.value,setCookie("username",niname.value,7),exit(),closefn(),enter())}):(""==phone.value&&(document.querySelector("#phone+span").innerHTML="请输入手机号",document.querySelector("#phone+span").style.display="block"),""==niname.value&&(document.querySelector("#niname+span").innerHTML="请输入密码",document.querySelector("#niname+span").style.display="block"),""==newpsw.value&&(document.querySelector("#newpsw+span").innerHTML="请输入密码",document.querySelector("#newpsw+span").style.display="block"))};var phonereg=/^(13[0-9]|14[5|7]|15[0|1|2|3|4|5|6|7|8|9]|18[0|1|2|3|5|6|7|8|9])\d{8}$/,namereg=/^[a-zA-Z][a-zA-Z0-9]{2,7}$/,pswreg=/^\w{6,10}$/;$("#phone").blur(function(){""==$(this).val()?$(this).next().show().text("请输入手机号"):phonereg.test($(this).val())?$(this).next().hide():$(this).next().show().text("请输入正确的手机号")}).keyup(function(){$(this).next().hide()}).parent().find("#niname").blur(function(){""==$(this).val()?$(this).next().show().text("请输入昵称"):$(this).val().length<3||8<$(this).val().length?$(this).next().show().text("昵称长度请保持在3~8位内"):namereg.test($(this).val())?$(this).next().hide():$(this).next().show().text("昵称请以字母开头，仅含数字和字母")}).keyup(function(){$(this).next().hide()}).parent().find("#newpsw").blur(function(){""==$(this).val()?$(this).next().show().text("请输入密码"):$(this).val().length<6||10<$(this).val().length?$(this).next().show().text("密码长度请保持在6~10位内"):pswreg.test($(this).val())?$(this).next().hide():$(this).next().show().text("密码为任意数字字母下划线")}).keyup(function(){$(this).next().hide()}),$(window).scroll(function(){700<=$(window).scrollTop()?$("#aside .toTop").show().click(function(){$("html,body").stop().animate({scrollTop:0},800,"linear")}):$("#aside .toTop").hide()}),$("#logo .center>img").click(function(){location.href="./index.html"});