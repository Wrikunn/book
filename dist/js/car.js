"use strict";var dlflag=!1;function sumfn(){for(var e=$("#shopcar input:checked").parent().find(".sum"),n=0,t=0;t<e.length;t++)n+=Number($(e[t]).text());0<(n=n.toFixed(2))?$(".shopcarFoot>em").show().find("i").text(n):$(".shopcarFoot>em").hide()}function phpnum(e,n){$.ajax({url:"./php/car.php",async:!1,data:{id:e,num:n}})}document.cookie.split(";").forEach(function(e){"username"==e.split("=")[0]&&(dlflag=!0,$.ajax({url:"./php/buy.php",async:!1,dataType:"json",success:function(e){var n=new Set;e.forEach(function(e){n.add(e.master)}),n.forEach(function(t){var p=$('\n                    <div class="shopcarPoint">\n                        <p>\n                            <input type="checkbox" name="" class="checkboxs"><span>'+t+"</span>\n                            <span></span>\n                            <span>店主：<b>"+t+"</b></span>\n                            <i>在线交谈</i>\n                        </p>\n                        <ul></ul>\n                    </div>\n                    ");p.insertBefore("#shopcar .shopcarFoot"),e.forEach(function(e){var n;p.find("span").eq(1).text(e.location),e.master==t&&((n=$("\n                            <li id="+e.id+'>\n                            <input type="checkbox" name="" id="">\n                            <img src='+e.imgpath+">\n                            <span>"+e.name+"</span>\n                            <span>"+e.quality+"</span>\n                            <span>"+e.price+'</span>\n                            <div>\n                                <input type="text" maxlength="3" value='+e.num+'>\n                                <button class="nummin">-</button>\n                                <button class="numplus">+</button>\n                            </div>\n                            <i class="sum">'+(e.num*e.price).toFixed(2)+'</i>\n                            <em>\n                                <span>移入收藏</span>\n                                <br>\n                                <span class="del">删除</span>\n                            </em>\n                        </li>\n                            ')).appendTo(p.find("ul")),1==e.num&&n.find(".nummin").addClass("unhov"))})}),0==e.length?$("#shopcar").hide().prev().show():$("#shopcar").show().prev().hide(),setTimeout(function(){layer.close(index)},100)}}))}),dlflag||($("#shopcar").hide().prev().show().html('您还没有登录，您可以<a href="./index.html">去登录</a>'),setTimeout(function(){layer.close(index)},100)),$(".numplus").click(function(){var e=Number($(this).prev().prev().val());e<999&&(e+=1,$(this).prev().prev().val(e).parent().next().text((e*$(this).parent().prev().text()).toFixed(2)),1<e&&$(this).prev().removeClass("unhov"),sumfn(),phpnum($(this).parent().parent().prop("id"),e))}).prev().click(function(){var e=Number($(this).prev().val());1<e&&(--e<=1&&($(this).addClass("unhov"),e=1),$(this).prev().val(e).parent().next().text((e*$(this).parent().prev().text()).toFixed(2))),sumfn(),phpnum($(this).parent().parent().prop("id"),e)}).prev().blur(function(){$(this).val()<=1||isNaN(Number($(this).val()))?($(this).next().addClass("unhov"),$(this).val(1).parent().next().text((+$(this).parent().prev().text()).toFixed(2))):$(this).next().removeClass("unhov").parent().next().text(($(this).val()*$(this).parent().prev().text()).toFixed(2)),sumfn(),phpnum($(this).parent().parent().prop("id"),$(this).val())});var inddel=void 0;function delfn(e){phpnum($(e.target).parent().parent().prop("id"),0),$.ajax({url:"./php/buy.php",async:!1,dataType:"json",success:function(e){0<e.length?$("#car").children().html("您的购物车内有<br>"+e.length+"件商品"):($("#car").children().html("<img src='img/car.png'><br>您的购物车是空的，快去挑些好书放进来吧。"),$("#shopcar").hide().prev().show())}}),(1==$(e.target).parent().parent().parent().find("li").length?$(e.target).parent().parent():$(e.target)).parent().parent().remove(),layer.close(inddel)}$(".del").click(function(e){inddel=layer.open({type:0,content:"是否删除商品",title:"提示",btn:["确定","取消"],skin:"tanchu",yes:function(){delfn(e)}})}),$(".checkAll").click(function(){this.checked?$('#shopcar input[type="checkbox"]').prop("checked",!0):$('#shopcar input[type="checkbox"]').prop("checked",!1)}),$(".checkboxs").click(function(){this.checked?$(this).parent().parent().find('input[type="checkbox"').prop("checked",!0):$(this).parent().parent().find('input[type="checkbox"').prop("checked",!1)}),$('input[type="checkbox"]').click(function(){sumfn()}),$('ul input[type="checkbox"]').click(function(){for(var e=$(this).parent().parent().find('input[type="checkbox"'),n=!0,t=0;t<e.length;t++)if(!e[t].checked){n=!1;break}n?$(this).parent().parent().prev().find(".checkboxs").prop("checked",!0):$(this).parent().parent().prev().find(".checkboxs").prop("checked",!1);for(var p=!0,c=0;c<$(".checkboxs").length;c++)if(!$(".checkboxs")[c].checked){p=!1;break}p?$(".checkAll").prop("checked",!0):$(".checkAll").prop("checked",!1)}),$(".checkboxs").click(function(){for(var e=!0,n=0;n<$(".checkboxs").length;n++)if(!$(".checkboxs")[n].checked){e=!1;break}e?$(".checkAll").prop("checked",!0):$(".checkAll").prop("checked",!1)}),$("#buy").click(function(){if(0==$("ul input:checked").length)return layer.msg("尚未选择任何商品",{time:1e3}),!1;for(var e=0;e<$('ul input[type="checkbox"]').length;e++){var n=$($('ul input[type="checkbox"]')[e]).parent().prop("id");sessionStorage.setItem(n,0)}for(var t=0;t<$("ul input:checked").length;t++){var p=$($("ul input:checked")[t]).parent().prop("id");sessionStorage.setItem(p,1)}document.location.href="./buy.html"});